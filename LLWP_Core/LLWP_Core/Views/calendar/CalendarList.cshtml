
@{
    ViewData["Title"] = "CalendarList";
    Layout = "~/Views/Shared/_Layout_chart.cshtml";
}

<style>
    .fc-day-number {
        float: right;
        font-size: 1.125rem;
        color: #4F4F4F;
    }

    .fc-title {
        color: #FAFAFA;
        font-size: 1rem;
    }

    .fc-event-container:hover {
        cursor: pointer;
    }
</style>
<div class="d-flex">
    <div>
        <nav class="nav flex-column booking-nav" style="width:170px">
            <a class="nav-link book-nav-link" href="/chart/ChartList">報表</a>
            <a class="nav-link book-nav-link" href="/calendar/CalendarList" style="color:#d35a5d">訂房狀態月曆</a>
            <a class="nav-link book-nav-link" href="/roomOrder/List">試住訂單管理</a>
            <a class="nav-link book-nav-link" href="/tryPet/List">寵物試養計畫</a>
            <a class="nav-link book-nav-link" href="/activityBack/index">活動管理</a>
            <a class="nav-link book-nav-link" href="/tryPet/Index">登出</a>
        </nav>
    </div>

    <div class="container-fluid">
        <h2 class="list-title">訂房狀態月曆</h2>
        <div>
            <div id="calendar" style="width:1200px;margin-bottom:50px"></div>
            <div id="myModal" class="modal" tabindex="-1" role="dialog">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 id="eventTitle" class="modal-title"></h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <p id="pDetails"></p>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">關閉</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<link href="//cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.4.0/fullcalendar.min.css" rel="stylesheet" />
<link href="//cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.4.0/fullcalendar.print.css" rel="stylesheet" media="print" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.17.47/css/bootstrap-datetimepicker.min.css" rel="stylesheet" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.4.0/fullcalendar.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.17.47/js/bootstrap-datetimepicker.min.js"></script>
<script type='text/javascript'>
    $(document).ready(function () {
        var events = [];
        $.ajax({
            type: "GET",
            url:"/Calendar/GetEvents_emptyRoom",
            success: function (data) {
                $.each(data,function(i,v)
                {
                    events.push({
                        title: `尚有${v.count}間空房`,
                        start: v.date,
                        end: v.date,
                        backgroundColor: '#7ea970',
                        borderColor: '#7ea970',
                        description: v.roomNum

                    });
                    //console.log("events: "+events);
                    //console.log("data: "+data);
                })
                GenerateCalendar(events);
            },
            error:function(error)
            {
                alert('Error');
            }
        });
        function GenerateCalendar(events) {
            $('#calendar').fullCalendar(
                {
                    //contentHeight: '80px',
                    //height:'100px',
                    defaultDate: new Date(),

                    timeFormat: 'h(:mm)a',
                    header: {
                        left: 'prev,next,today',
                        center: 'title',
                        right: 'month'
                        //right: 'month,basicWeek,basicDay,agenda'
                    },
                    weekMode:'vairiable',
                    monthNames: ['一月', '二月', '三月', '四月', '五月', '六月', '七月', '八月', '九月', '十月', '十一月', '十二月'],
                    dayNames: ['星期日', '星期一', '星期二', '星期三', '星期四', '星期五', '星期六'],
                    dayNamesShort: ['日', '一', '二', '三', '四', '五', '六'],
                    today: ["今天"],
                    buttonText: {
                        prev: '<<',
                        next: '>>',
                        prevYear: '上一年;',
                        nextYear: '下一年',
                        today: '今天',
                        month: '月',
                        week: '週',
                        day: '日'
                    },
                    eventLimit: true,
                    //eventColor: '#378006',
                    events: events,
                    eventClick: function (calEvent, jsEvent, view) {
                        //console.log("calEvent: " + calEvent);
                        //$('#myModal #eventTitle').text(calEvent.title);
                        var $description = $('<div/>');
                        $.each(calEvent.description, function (index, element) {
                            //console.log("element: " + element);
                            //$description.append($('<p/>').html(`<p/>入住日:${element.inRoom}<br/></p><p>退房日:${element.outRoom}<br/></p><p>房號:${element.roomNum}<p/>`));
                            $description.append($('<p/>').html(`<h5>第${index + 1}筆：</h5><p>訂單編號：${element.orderNum}</p><p>入住日：${element.inRoom}<br/></p><p>退房日：${element.outRoom}<br/></p><p>房號：${element.roomNum}<p/>`));

                        });
                        $('#eventTitle').text("訂房資訊");
                        //console.log("calEvent.description: " + calEvent.description)
                        //console.log("calEvent.description[i]: " + calEvent.description);
                        $('#myModal #pDetails').empty().html($description);

                        $('#myModal').modal();;
                    }
                })
        }
    });
</script>


