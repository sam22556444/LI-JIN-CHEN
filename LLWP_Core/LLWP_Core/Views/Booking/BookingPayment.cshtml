@model LLWP_Core.ViewModels.BookingPaymentVM
@using Microsoft.AspNetCore.Http;
@using Microsoft.Extensions.Options
@inject IOptions<LLWP_Core.Utility.StripeSettings> Stripe
@{
    ViewData["Title"] = "榕沛社區 - 試住體驗訂單確認";
    Layout = "~/Views/Shared/_Layout_payment.cshtml";
    var petRoom = "";
    var roomType = "一房一廳";
    var gender = "先生";
    var nonTaxSum = Convert.ToDouble(Model.tortable.FOrTotalPrice) / 1.05;
    var Tax = nonTaxSum * 0.05;
    if (Model.tortable.FOrTryPet == "Y")
    {
        petRoom = "寵物房";
    }
    if (Model.roomType == 2)
    {
        roomType = "一房二廳";
    }

}

<form method="post">
    <div class="container">
        <div class="checkOrder_detailDiv mt5">
            <h3 class="mt5 mb2 fz2">住房明細 </h3>
            <div class="row p-3 rounded mb-2 shadow-sm fz125 lh25" style="border:#F8B73B 2px solid; background-color: #ffffff;">
                <div class="w-40 ml15">
                    <div class="d-flex checkOrder_detailContainerDivSet">
                        <div class="checkOrder_detailLeft">
                            訂單編號：
                        </div>
                        <div class="checkOrder_detailRight">
                            @Model.tortable.FOrNum
                        </div>
                    </div>
                    <div class="d-flex checkOrder_detailContainerDivSet">
                        <div class="checkOrder_detailLeft">
                            入住日期：
                        </div>
                        <div class="checkOrder_detailRight">
                            @Model.tortable.FOrCheckIn
                        </div>
                    </div>
                    <div class="d-flex checkOrder_detailContainerDivSet">
                        <div class="checkOrder_detailLeft">
                            退房日期：
                        </div>
                        <div class="checkOrder_detailRight">
                            @Model.tortable.FOrCheckOut
                        </div>
                    </div>
                    <div class="d-flex checkOrder_detailContainerDivSet">
                        <div class="checkOrder_detailLeft">
                            住宿天數：
                        </div>
                        <div class="checkOrder_detailRight">
                            @Model.tortable.FOrday 天
                        </div>
                    </div>
                    <div class="d-flex checkOrder_detailContainerDivSet">
                        <div class="checkOrder_detailLeft">
                            房間類型：
                        </div>
                        <div class="checkOrder_detailRight">
                            @petRoom @roomType
                        </div>
                    </div>
                </div>
                <div class="w-40 ml15">
                    <div class="d-flex checkOrder_detailContainerDivSet">
                        <div class="checkOrder_detailLeft">
                            住宿人數：
                        </div>
                        <div class="checkOrder_detailRight" style="margin-left:30px">
                            @Model.tortable.FOrPeople 位
                        </div>
                    </div>
                    <div class="d-flex checkOrder_detailContainerDivSet">
                        <div class="checkOrder_detailLeft">
                            會員編號(一)：
                        </div>
                        <div class="checkOrder_detailRight">
                            @Model.memberdata.FMeNumber
                        </div>
                    </div>
                    <div class="d-flex checkOrder_detailContainerDivSet">
                        <div class="checkOrder_detailLeft">
                            會員姓名(一)：
                        </div>
                        <div class="checkOrder_detailRight">
                            @Model.memberdata.FMeName
                        </div>
                    </div>
                    <div class="d-flex checkOrder_detailContainerDivSet">
                        <div class="checkOrder_detailLeft">
                            會員編號(二)：
                        </div>
                        @if (Model.tortable.FOrPeople == 1)
                        {
                            <div class="checkOrder_detailRight">
                                無
                            </div>
                        }
                        else
                        {
                            <div class="checkOrder_detailRight">
                                59580201002
                            </div>
                        }
                    </div>
                    <div class="d-flex checkOrder_detailContainerDivSet">
                        <div class="checkOrder_detailLeft">
                            會員姓名(二)：
                        </div>
                        @if (Model.tortable.FOrPeople == 1)
                        {
                            <div class="checkOrder_detailRight">
                                無
                            </div>
                        }
                        else
                        {
                            <div class="checkOrder_detailRight">
                                王瑩恆
                            </div>
                        }
                    </div>
                </div>
            </div>
            @if (Model.tortable.FOrGuestOneActivityA != null)
            {
                @if (Model.memberdata.FMeGender == "女")
                {
                    gender = "小姐";
                }
                <h3 class="mt5 mb2 fz2">活動明細：房客一　@Model.memberdata.FMeName @gender</h3>
                <div class="row p-3 rounded mb-2 shadow-sm fz125 lh25" style="border:#F8B73B 2px solid; background-color: #ffffff; display: flex; justify-content: space-around;">
                    @foreach (var item in Model.activitydataOne)
                    {
                        <div class="card ml-4 mr-4 mt-4" style="min-width:280px;max-width:280px; margin-bottom:20px">
                            <img src="@item.FActivityImages" class="card-img-top">
                            <div class="card-body">
                                <h5 class="card-title tac ls025 fz15">@item.FActivityName</h5>
                                <p class="card-text">
                                    <ul class="list-unstyled fz1 lh25 ml10">
                                        <li>日期時間：@item.FActivityTime</li>
                                        @if (item.FActivityPrice == 0)
                                        {
                                            <li>費用：免費參加</li>
                                        }
                                        else
                                        {
                                            <li>費用：@string.Format("{0:#}", @item.FActivityPrice) 元</li>
                                        }
                                        <li>活動地點：@item.FActivityLocation</li>
                                    </ul>
                                </p>
                            </div>
                        </div>
                    }
                </div>
            }
            @if (Model.tortable.FOrGuestTwoActivityA != null)
            {
                <h3 class="mt5 mb2 fz2">活動明細：會員二　王瑩恆 小姐</h3>
                <div class="row p-3 rounded mb-2 shadow-sm fz125 lh25" style="border:#F8B73B 2px solid; background-color: #ffffff; display: flex; justify-content: space-around;">
                    @foreach (var item in Model.activitydataTwo)
                    {
                        <div class="card ml-4 mr-4 mt-4" style="min-width:280px;max-width:280px; margin-bottom:20px">
                            <img src="@item.FActivityImages" class="card-img-top">
                            <div class="card-body">
                                <h5 class="card-title tac ls025 fz15">@item.FActivityName</h5>
                                <p class="card-text">
                                    <ul class="list-unstyled fz1 lh25 ml10">
                                        <li>日期時間：@item.FActivityTime</li>
                                        @if (item.FActivityPrice == 0)
                                        {
                                            <li>費用：免費參加</li>
                                        }
                                        else
                                        {
                                            <li>費用：@string.Format("{0:#}", @item.FActivityPrice) 元</li>
                                        }
                                        <li>活動地點：@item.FActivityLocation</li>
                                    </ul>
                                </p>
                            </div>
                        </div>
                    }
                </div>
            }
            @if (Model.tortable.FOrTryPet == "Y")
            {
                <h3 class="mt5 mb2 fz2">試養寵物與訂單金額明細</h3>
                <div class="d-flex justify-content-lg-center">
                    <div class="row p-3 pt-4 rounded mb-2 shadow-sm fz125 lh25 w-75 justify-content-between align-items-center" style="border:#F8B73B 2px solid; background-color: #ffffff;">
                        <div class="w-25">
                            <div class="card ml-4 mr-3" style="min-width:310px;max-width:310px; margin-bottom:20px">
                                <img src="@Model.tryPetTable.FTryPetPhoto" class="card-img-top">
                                <div class="card-body">
                                    <h5 class="card-title tac ls025 fz15 mt2 mb3 mb0">@Model.tryPetTable.FTryPetName</h5>
                                    <p class="card-text">
                                        <ul class="list-unstyled fz1 lh25 ml15">
                                            <li>種類：@Model.tryPetTable.FTryPetVar　<span class="ml10">性別：@Model.tryPetTable.FTryPetSex</span></li>
                                            <li>年齡： @Model.tryPetTable.FTryPetAge 歲<span class="ml10">體重：@Model.tryPetTable.FTryPetWei 公斤</span></li>
                                            <li>已絕育：@Model.tryPetTable.FTryPetFix<span class="ml10">個性：@Model.tryPetTable.FTryPetNature</span></li>
                                        </ul>
                                    </p>
                                </div>
                            </div>
                        </div>
                        <div class="w-50 h-75 pr-5">
                            <div class="d-flex checkOrder_detailContainerDivSet justify-content-between">
                                <div class="checkOrder_detailLeft">
                                    住房金額：
                                </div>
                                <div class="checkOrder_detailRight" style="margin-left:30px">
                                    @Model.daysMoney
                                </div>
                            </div>
                            <div class="d-flex checkOrder_detailContainerDivSet justify-content-between">
                                <div class="checkOrder_detailLeft">
                                    參加活動金額：
                                </div>
                                @if (Model.activityMoney == 0)
                                {
                                    <div class="checkOrder_detailRight">
                                        @string.Format("{0:#}", Model.activityMoney)
                                    </div>
                                }
                                else
                                {
                                    <div class="checkOrder_detailRight">
                                        @string.Format("{0:#}", Model.activityMoney)
                                    </div>
                                }
                            </div>
                            <hr />
                            <div class="d-flex checkOrder_detailContainerDivSet justify-content-between">
                                <div class="checkOrder_detailLeft">
                                    小計(未含稅)：
                                </div>
                                <div class="checkOrder_detailRight">
                                    @string.Format("{0:#}", nonTaxSum)
                                </div>
                            </div>
                            <div class="d-flex checkOrder_detailContainerDivSet justify-content-between">
                                <div class="checkOrder_detailLeft">
                                    稅：
                                </div>
                                <div class="checkOrder_detailRight">
                                    @string.Format("{0:#}", Tax)
                                </div>
                            </div>
                            <div class="d-flex checkOrder_detailContainerDivSet justify-content-between">
                                <div class="checkOrder_detailLeft">
                                    合計金額(含稅)：
                                </div>
                                <div class="checkOrder_detailRight">
                                    @string.Format("{0:#}", Model.tortable.FOrTotalPrice)
                                </div>
                            </div>
                            <hr />
                            <div class="d-flex checkOrder_detailContainerDivSet justify-content-between" style="font-size:30px; color:#F8B73B">
                                <div class="checkOrder_detailLeft">
                                    總價：
                                </div>
                                <div class="checkOrder_detailRight">
                                    @string.Format("{0:#}", Model.tortable.FOrTotalPrice)
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            }
            else
            {
                <h3 class="mt5 mb2 fz2">訂單金額明細</h3>
                <div class="d-flex justify-content-lg-center">
                    <div class="row p-3 pt-4 rounded mb-2 shadow-sm fz125 lh25 w-75 justify-content-between align-items-center" style="border:#F8B73B 2px solid; background-color: #ffffff;">
                        <div class="w-100 h-100 pr-5 pl-5">
                            <div class="d-flex checkOrder_detailContainerDivSet justify-content-between">
                                <div class="checkOrder_detailLeft">
                                    住房金額：
                                </div>
                                <div class="checkOrder_detailRight" style="margin-left:30px">
                                    @Model.daysMoney
                                </div>
                            </div>
                            <div class="d-flex checkOrder_detailContainerDivSet justify-content-between">
                                <div class="checkOrder_detailLeft">
                                    參加活動金額：
                                </div>
                                @if (Model.activityMoney == 0)
                                {
                                    <div class="checkOrder_detailRight">
                                        0
                                    </div>
                                }
                                else
                                {
                                    <div class="checkOrder_detailRight">
                                        @string.Format("{0:#}", Model.activityMoney)
                                    </div>
                                }

                            </div>
                            <hr />
                            <div class="d-flex checkOrder_detailContainerDivSet justify-content-between">
                                <div class="checkOrder_detailLeft">
                                    小計(未含稅)：
                                </div>
                                <div class="checkOrder_detailRight">
                                    @string.Format("{0:#}", nonTaxSum)
                                </div>
                            </div>
                            <div class="d-flex checkOrder_detailContainerDivSet justify-content-between">
                                <div class="checkOrder_detailLeft">
                                    稅：
                                </div>
                                <div class="checkOrder_detailRight">
                                    @string.Format("{0:#}", Tax)
                                </div>
                            </div>
                            <div class="d-flex checkOrder_detailContainerDivSet justify-content-between">
                                <div class="checkOrder_detailLeft">
                                    合計金額(含稅)：
                                </div>
                                <div class="checkOrder_detailRight">
                                    @string.Format("{0:#}", Model.tortable.FOrTotalPrice)
                                </div>
                            </div>
                            <hr />
                            <div class="d-flex checkOrder_detailContainerDivSet justify-content-between" style="font-size:30px; color:#F8B73B">
                                <div class="checkOrder_detailLeft">
                                    總價：
                                </div>
                                <div class="checkOrder_detailRight">
                                    @string.Format("{0:#}", Model.tortable.FOrTotalPrice)
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            }
            <h3 class="mt5 mb2 fz2">注意事項</h3>
            <div class="row p-3 rounded mb-5 shadow-sm fz125 lh25" style="border:#F8B73B 2px solid; background-color: #ffffff; display: flex; justify-content: space-around;">
                <ul>
                    <li class="mb-2 ml3">
                        重要提示:若您是以信用卡付款，請於入住時出示用於此預訂的信用卡以及一張附有照片的有效證件，否則，社區有權將此預訂視為無效訂單，或是要求收取額外費用。<br>
                        如果您是為他人預訂住宿但不會與其同行，則請對方務必攜帶此預訂入住憑證辦理入住即可。
                    </li>
                    <li class="mb-2 ml3">您預訂的客房在預訂入住日期當天將保證仍是空房，如果您未依預訂日期入住，您預訂的房間將有可能被取消。更多取消與No-show相關政策請見預訂過程及訂單確認信上的說明。</li>
                </ul>
            </div>

            <div>
                <div class="mt5 mb-3 containerFont">
                    <span>付款方式</span>
                </div>
                <div class="divMargin">
                    <div class="bg-white rounded-lg shadow-sm p-5 row" style="display: block;">
                        <!-- Credit card form tabs -->
                        <ul role="tablist" class="nav bg-light nav-pills rounded-pill nav-fill mb-3">
                            <li class="nav-item">
                                <a data-toggle="pill" href="#nav-tab-card" class="nav-link active rounded-pill">
                                    <i class="fa fa-credit-card"></i>
                                    信用卡支付
                                </a>
                            </li>
                            <li class="nav-item">
                                <a data-toggle="pill" href="#nav-tab-paypal" class="nav-link rounded-pill">
                                    <i class="fab fa-paypal"></i>
                                    Paypal支付
                                </a>
                            </li>
                            <li class="nav-item">
                                <a data-toggle="pill" href="#nav-tab-bank" class="nav-link rounded-pill">
                                    <i class="fa fa-university"></i>
                                    銀行匯款支付
                                </a>
                            </li>
                        </ul>
                        <!-- End -->
                        <!-- Credit card form content -->
                        <div class="tab-content">
                            <!-- credit card info-->
                            <div id="nav-tab-card" class="tab-pane fade show active">
                                <img src="/images/credit_Card.png" class="pb-3" width="200">
                                <p>通過Stripe進行信用卡支付功能！</p>

                                @if (Context.Session.GetString("SK_ROOMTYPE") == "1")
                                {
                                    var stripetotalMoney = @Model.tortable.FOrTotalPrice * 100 / 30;
                                    <script src="https://checkout.stripe.com/checkout.js" class="stripe-button"
                                            data-key="@Stripe.Value.PublishableKey"
                                            data-amount="@stripetotalMoney"
                                            data-name="榕沛社區訂房功能"
                                            data-label="Stripe 信用卡支付"
                                            data-description="支付 @string.Format("{0:#}",Model.tortable.FOrTotalPrice) 元，總住宿日 @Model.tortable.FOrday 天"
                                            data-locale="auto"
                                            data-allow-remember-me="false"
                                            data-currency="USD"
                                            data-image="https://stripe.com/img/documentation/checkout/marketplace.png">
                                    </script>
                                    <script>
                                        document.getElementsByClassName("stripe-button-el")[0].style.display = 'none';
                                    </script>
                                }
                                <p>
                                    <button type="button" class="placeorderforstripe btn btn-primary rounded-pill" id="stripe-button" name="stipeButton" value="stipeButton"><i class="fab fa-cc-stripe"></i> Stripe 信用卡支付</button>
                                </p>
                            </div>
                            <!-- End -->
                            <!-- Paypal info -->
                            <div id="nav-tab-paypal" class="tab-pane fade">
                                <p>Paypal is easiest way to pay online</p>

                                <p>
                                    <button type="submit" class="placeorder btn btn-primary rounded-pill" id="paypal-button" name="payPalButton" value="payPalButton"><i class="fab fa-paypal mr-1"></i> Log into my Paypal</button>
                                </p>
                            </div>
                            <!-- End -->
                            <!-- bank transfer info -->
                            <div id="nav-tab-bank" class="tab-pane fade">
                                <h6>Bank account details</h6>
                                <dl>
                                    <dt>Bank</dt>
                                    <dd> THE WORLD BANK</dd>
                                </dl>
                                <dl>
                                    <dt>Account number</dt>
                                    <dd>7775877975</dd>
                                </dl>
                                <dl>
                                    <dt>IBAN</dt>
                                    <dd>CZ7775877975656</dd>
                                </dl>
                                <p class="text-muted">
                                    Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed
                                    do eiusmod tempor incididunt ut labore et dolore magna aliqua.
                                </p>
                            </div>
                            <!-- End -->
                        </div>
                        <!-- End -->
                    </div>
                </div>
                <input type="hidden" id="paymentCheckedInput" value="@Context.Session.GetString("SK_Payment")" />
            </div>
            <div class="container-fluid">
                <div class="container pb3">
                    <div class="row justify-content-between">
                        <a class="btn btn-warning fz15 ls025" asp-action="BookingRoomSelect" asp-controller="Booking" role="button">返回上一步</a>
                        <a class="btn btn-warning fz15 ls025" href="#" role="button" id="sure-check">確定結帳</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</form>




